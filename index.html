<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GBC Daily Devotional</title>
<style>
  :root {
    --arrow-size: 20px;
    --arrow-color: #555; /* Darker arrow */
    --arrow-padding-right: 7.5px;
    --box-bg: rgba(255, 255, 255, 0.9); /* Increased opacity */
    --box-radius: 8px;
    --box-shadow: 0 0 8px rgba(0,0,0,0.1);
    --font-family: Helvetica, Arial, sans-serif;
    --padding-base: 7.5px;
    --margin-base: 7.5px;
    --heading-color: var(--arrow-color);
    --line-height-base: 1.5;
  }
  html, body {
    margin: 0; padding: 0; min-height: 100%;
    font-family: var(--font-family);
    background: transparent;
    color: #000;
  }
  #bg-image {
    position: fixed; inset: 0;
    background-position: center;
    background-size: cover;
    opacity: 0.8;
    z-index: -1;
    filter: brightness(0.9);
  }
  .container {
    max-width: 900px;
    margin: var(--margin-base) auto;
    padding: 0 var(--margin-base);
  }
  .flex-top {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: calc(var(--margin-base) * 2);
  }
  .box {
    background-color: var(--box-bg);
    border-radius: var(--box-radius);
    padding: var(--padding-base);
    box-shadow: var(--box-shadow);
    margin-bottom: var(--margin-base);
    width: 100%;
    box-sizing: border-box;
  }
  #date {
    font-weight: bold;
    font-size: 3.42em;
    line-height: 1.2;
    color: white;
    flex: 1 1 280px;
    min-width: 280px;
    margin: calc(var(--margin-base) * 1.5);
    user-select: none;
  }
  h2.collapsible-header {
    margin: 0;
    font-size: 1.2em;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    padding: var(--padding-base);
    box-sizing: border-box;
    color: var(--heading-color);
  }
  .arrow-icon {
    width: var(--arrow-size);
    height: var(--arrow-size);
    margin-left: auto;
    margin-right: var(--arrow-padding-right);
    fill: var(--arrow-color);
    transition: transform 0.3s ease;
    flex-shrink: 0;
    shape-rendering: geometricPrecision;
  }
  h2.active .arrow-icon {
    transform: rotate(90deg);
  }
  .collapsible-content {
    margin-top: var(--margin-base);
    padding: var(--margin-base) var(--arrow-padding-right);
    box-sizing: border-box;
    text-align: left;
    display: none;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }
  .collapsible-content.show {
    display: block;
  }
  .podcast-player select {
    width: 100%;
    margin-bottom: var(--margin-base);
    padding: var(--padding-base);
    border-radius: 4px;
    font-size: 1em;
    box-sizing: border-box;
    position: relative;
    padding-right: calc(var(--arrow-padding-right) + 20px);
  }
  audio {
    width: 100%;
    border-radius: var(--box-radius);
    outline: none;
    box-shadow: 0 0 6px rgba(0,0,0,0.3);
  }
  ul.members-list {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  ul.members-list li {
    margin: var(--margin-base) 0;
  }
  .ten-words-section ol {
    padding-left: 0;
    margin: 0;
    list-style-position: inside;
    text-align: left;
  }
  .ten-words-section ol li {
    margin-bottom: var(--margin-base);
  }
  #psalm-content {
    font-style: normal;
    line-height: var(--line-height-base);
    min-height: 60px;
    white-space: normal;
    text-align: justify;
  }
  .bottom-spacer {
    height: var(--margin-base);
  }
</style>
</head>
<body>
<div id="bg-image"></div>
<div class="container">
  <!-- content here as before -->
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const getSeed = () => new Date().toISOString().slice(0,10).replace(/-/g,'');
    const hash = [...getSeed()].reduce((h,c) => h * 31 + c.charCodeAt(0), 0);
    const rand = (h) => Math.abs(Math.sin(h)) % 1;

    const bg = document.getElementById('bg-image');
    const storedDate = localStorage.getItem("bgDate");
    const storedUrl = localStorage.getItem("bgUrl");
    if(storedDate === getSeed() && storedUrl) {
      bg.style.backgroundImage = `url('${storedUrl}')`;
    } else {
      fetch("https://api.unsplash.com/photos/random?query=landscape&orientation=landscape&client_id=aa3DZ6SZRXFXkV2Hk90D4F7XdTi6bSPbNekst2guXro")
        .then(res => res.json())
        .then(data => {
          const url = data.urls?.full || data.urls?.regular;
          if(url) {
            bg.style.backgroundImage = `url('${url}')`;
            localStorage.setItem("bgUrl", url);
            localStorage.setItem("bgDate", getSeed());
          }
        })
        .catch(() => {
          bg.style.backgroundImage = "url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=80')";
        });
    }

    document.getElementById("date").innerHTML = (() => {
      const dt = new Date();
      return `<div>${dt.toLocaleDateString(undefined, {weekday:'long'})}</div><div>${dt.getDate()} ${dt.toLocaleDateString(undefined, {month:'long'})} ${dt.getFullYear()}</div>`;
    })();

    document.querySelectorAll(".collapsible-header").forEach(header => {
      header.setAttribute("tabindex", "0");
      header.addEventListener("click", () => {
        header.classList.toggle("active");
        header.nextElementSibling.classList.toggle("show");
      });
      header.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          header.click();
        }
      });
    });

    const members = ["Chris Fall","Amy Fall","Aron Williams","Isabel Williams","Lee Jones","Sam Smith"];
    const shuffled = [...members];
    for(let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(rand(hash + i) * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    const prayerList = document.getElementById("prayer-members");
    prayerList.innerHTML = '';
    shuffled.slice(0, 2).forEach(m => {
      const li = document.createElement('li');
      li.textContent = m;
      prayerList.appendChild(li);
    });

    fetch(`https://corsproxy.io/?${encodeURIComponent('https://anchor.fm/s/5073b270/podcast/rss')}`)
      .then(r => r.text())
      .then(xmlText => {
        const doc = new DOMParser().parseFromString(xmlText, "application/xml");
        const items = [...doc.querySelectorAll("item")];
        const select = document.getElementById("episode-select");
        const audio = document.getElementById("audio-player");
        items.forEach((item, i) => {
          const title = item.querySelector("title")?.textContent || `Episode ${i + 1}`;
          const url = item.querySelector("enclosure")?.getAttribute("url");
          if(url) {
            const opt = document.createElement("option");
            opt.value = url;
            opt.textContent = title;
            select.appendChild(opt);
          }
        });
        select.selectedIndex = 0;
        audio.src = select.value;
        select.onchange = () => audio.src = select.value;
      })
      .catch(() => {
        document.getElementById("podcast-player").innerHTML = `<p style="color:red;">Podcast load failed.</p>`;
      });

    fetch(`https://bible-api.com/psalm+${1 + Math.floor(rand(hash) * 150)}?translation=web`)
      .then(res => res.json())
      .then(data => {
        const psalm = document.getElementById("psalm-content");
        if(data.reference && data.verses) {
          psalm.innerHTML = `<strong>${data.reference}</strong><br>` + data.verses.map(v => `<sup>${v.verse}</sup> ${v.text.trim()}`).join(' ');
        } else {
          psalm.textContent = "Failed to load Psalm.";
        }
      })
      .catch(() => {
        document.getElementById("psalm-content").textContent = "Failed to load Psalm.";
      });
  });
</script>
</body>
</html>
