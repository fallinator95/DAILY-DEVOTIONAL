<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GBC Daily Devotional</title>
<style>
  :root {
    --arrow-size: 20px;
    --arrow-color: black;
    --arrow-padding-right: 7.5px;
    --box-bg: rgba(255, 255, 255, 0.8);
    --box-radius: 8px;
    --box-shadow: 0 0 8px rgba(0,0,0,0.1);
    --font-family: Helvetica, Arial, sans-serif;
    --padding-base: 7.5px;
    --margin-base: 7.5px;
    --heading-color: var(--arrow-color);
    --line-height-base: 1.5;
  }
  html, body {
    margin: 0; padding: 0; min-height: 100%;
    font-family: var(--font-family);
    background: transparent; 
    color: #000;
  }
  #bg-image {
    position: fixed; inset: 0;
    background-position: center;
    background-size: cover;
    opacity: 0.8;
    z-index: -1;
    filter: brightness(0.9);
  }
  .container {
    max-width: 900px;
    margin: var(--margin-base) auto;
    padding: 0 var(--margin-base);
  }
  .flex-top {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: calc(var(--margin-base) * 2);
  }
  .box {
    background-color: var(--box-bg);
    border-radius: var(--box-radius);
    padding: var(--padding-base);
    box-shadow: var(--box-shadow);
    margin-bottom: var(--margin-base);
    width: 100%;
    box-sizing: border-box;
  }
  #date {
    font-weight: bold;
    font-size: 3.42em;
    line-height: 1.2;
    color: white;
    flex: 1 1 280px;
    min-width: 280px;
    margin: calc(var(--margin-base) * 1.5);
    user-select: none;
  }
  h2.collapsible-header {
    margin: 0;
    font-size: 1.2em;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    padding: var(--padding-base);
    box-sizing: border-box;
    color: black;
  }
  .arrow-icon {
    width: var(--arrow-size);
    height: var(--arrow-size);
    margin-left: auto;
    margin-right: var(--arrow-padding-right);
    fill: black;
    transition: transform 0.3s ease;
    flex-shrink: 0;
    shape-rendering: geometricPrecision;
  }
  h2.active .arrow-icon {
    transform: rotate(90deg);
  }
  .collapsible-content {
    background-color: rgba(255, 255, 255, 0.8);
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    padding: 0 var(--padding-base);
    box-sizing: border-box;
    text-align: left;
    transition: max-height 0.5s ease, opacity 0.5s ease, padding 0.3s ease;
  }
  .collapsible-content.show {
    max-height: 1000px;
    opacity: 1;
    padding: var(--padding-base);
  }
  .podcast-player select {
    width: 100%;
    margin-bottom: var(--margin-base);
    padding: var(--padding-base);
    border-radius: 4px;
    font-size: 1em;
    box-sizing: border-box;
    position: relative;
    padding-right: calc(var(--arrow-padding-right) + 20px);
    background-color: rgba(255, 255, 255, 0.8);
    border: 1px solid #ccc;
  }
  audio {
    width: 100%;
    border-radius: var(--box-radius);
    outline: none;
    box-shadow: 0 0 6px rgba(0,0,0,0.3);
  }
  ul.members-list {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  ul.members-list li {
    margin: var(--margin-base) 0;
  }
  .ten-words-section ol {
    padding-left: 0;
    margin: 0;
    list-style-position: inside;
    text-align: left;
  }
  .ten-words-section ol li {
    margin-bottom: var(--margin-base);
  }
  #psalm-content {
    font-style: normal;
    line-height: var(--line-height-base);
    min-height: 60px;
    white-space: normal;
    text-align: justify;
  }
  .bottom-spacer {
    height: var(--margin-base);
  }
</style>
</head>
<body>
  <div id="bg-image"></div>
  <div class="container">

    <div class="flex-top">
      <div id="date"></div>

      <div class="box">
        <h2 class="collapsible-header">
          Verse of The Day
          <svg class="arrow-icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 4 L14 10 L6 16 Z" />
          </svg>
        </h2>
        <div class="collapsible-content">
          <script src="https://www.biblegateway.com/votd/votd.write.callback.js"></script>
          <script src="https://www.biblegateway.com/votd/get/?format=json&version=NIV&callback=BG.votdWriteCallback"></script>
          <noscript>
            <iframe src="https://www.biblegateway.com/votd/get/?format=html&version=NIV"
              title="Verse of the Day" width="100%" height="200"></iframe>
          </noscript>
        </div>
      </div>
    </div>

    <div class="box">
      <h2 class="collapsible-header">
        Members to Pray For Today
        <svg class="arrow-icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 4 L14 10 L6 16 Z" />
        </svg>
      </h2>
      <div class="collapsible-content">
        <ul class="members-list" id="prayer-members"></ul>
      </div>
    </div>

    <div class="box">
      <h2 class="collapsible-header">
        Latest RBT Reading
        <svg class="arrow-icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 4 L14 10 L6 16 Z" />
        </svg>
      </h2>
      <div class="collapsible-content podcast-player" id="podcast-player">
        <select id="episode-select"></select>
        <audio id="audio-player" controls preload="none"></audio>
      </div>
    </div>

    <div class="box">
      <h2 class="collapsible-header">
        The 10 Words
        <svg class="arrow-icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 4 L14 10 L6 16 Z" />
        </svg>
      </h2>
      <div class="collapsible-content ten-words-section">
        <ol>
          <li>You shall have no other gods before me.</li>
          <li>You shall not make for yourself a carved image.</li>
          <li>You shall not take the name of the Lord your God in vain.</li>
          <li>Remember the Sabbath day, to keep it holy.</li>
          <li>Honor your father and your mother.</li>
          <li>You shall not murder.</li>
          <li>You shall not commit adultery.</li>
          <li>You shall not steal.</li>
          <li>You shall not bear false witness against your neighbor.</li>
          <li>You shall not covet.</li>
        </ol>
      </div>
    </div>

    <div class="box">
      <h2 class="collapsible-header">
        Psalm of The Day
        <svg class="arrow-icon" viewBox="0 0 20 20" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 4 L14 10 L6 16 Z" />
        </svg>
      </h2>
      <div class="collapsible-content psalm-section" id="psalm-section">
        <div id="psalm-content">Loading...</div>
      </div>
    </div>

    <div class="bottom-spacer"></div>
  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const bg = document.getElementById('bg-image');
    const dateEl = document.getElementById("date");
    const collapsibleHeaders = document.querySelectorAll(".collapsible-header");
    const prayerList = document.getElementById("prayer-members");
    const episodeSelect = document.getElementById("episode-select");
    const audioPlayer = document.getElementById("audio-player");
    const psalmContent = document.getElementById("psalm-content");

    // Simple seeded random for deterministic daily values
    const seed = new Date().toISOString().slice(0,10).replace(/-/g,'');
    const hash = [...seed].reduce((h,c) => h * 31 + c.charCodeAt(0), 0);
    const rand = (h) => Math.abs(Math.sin(h)) % 1;

    // Background image caching
    const storedDate = localStorage.getItem("bgDate");
    const storedUrl = localStorage.getItem("bgUrl");
    if(storedDate === seed && storedUrl) {
      bg.style.backgroundImage = `url('${storedUrl}')`;
    } else {
      fetch("https://api.unsplash.com/photos/random?query=landscape&orientation=landscape&client_id=aa3DZ6SZRXFXkV2Hk90D4F7XdTi6bSPbNekst2guXro")
        .then(res => res.json())
        .then(data => {
          const url = data.urls?.full || data.urls?.regular;
          if(url) {
            bg.style.backgroundImage = `url('${url}')`;
            localStorage.setItem("bgUrl", url);
            localStorage.setItem("bgDate", seed);
          }
        })
        .catch(() => {
          bg.style.backgroundImage = "url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=80')";
        });
    }

    // Date display
    const dt = new Date();
    const dayName = dt.toLocaleDateString(undefined, {weekday:'long'});
    const dayNum = dt.getDate();
    const monthName = dt.toLocaleDateString(undefined, {month:'long'});
    const yearNum = dt.getFullYear();
    dateEl.innerHTML = `<div>${dayName}</div><div>${dayNum} ${monthName} ${yearNum}</div>`;

    // Collapsible toggling
    collapsibleHeaders.forEach(header => {
      header.addEventListener("click", () => {
        header.classList.toggle("active");
        header.nextElementSibling.classList.toggle("show");
      });
    });

    // Members to Pray For Today (random 2 daily)
    const members = ["Chris Fall","Amy Fall","Aron Williams","Isabel Williams","Lee Jones","Sam Smith"];
    const shuffled = [...members];
    for(let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(rand(hash + i) * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    prayerList.innerHTML = '';
    shuffled.slice(0, 2).forEach(m => {
      const li = document.createElement('li');
      li.textContent = m;
      prayerList.appendChild(li);
    });

    // Podcast episodes loading and selection
    fetch(`https://corsproxy.io/?${encodeURIComponent('https://anchor.fm/s/5073b270/podcast/rss')}`)
      .then(r => r.text())
      .then(xmlText => {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "application/xml");
        const items = [...xmlDoc.querySelectorAll("item")];
        items.forEach((item, i) => {
          const title = item.querySelector("title")?.textContent || `Episode ${i + 1}`;
          const url = item.querySelector("enclosure")?.getAttribute("url");
          if(url) {
            const option = document.createElement("option");
            option.value = url;
            option.textContent = title;
            episodeSelect.appendChild(option);
          }
        });
        episodeSelect.selectedIndex = 0;
        audioPlayer.src = episodeSelect.value;
        episodeSelect.onchange = () => audioPlayer.src = episodeSelect.value;
      })
      .catch(() => {
        episodeSelect.innerHTML = "<option>Error loading episodes</option>";
      });

   // Psalm of The Day
    const psalmNum = 1 + Math.floor(rand(hash) * 150);
    fetch(`https://bible-api.com/psalm+${psalmNum}?translation=web`)
      .then(res => res.json())
      .then(data => {
        if(data.reference && data.verses) {
          let html = `<strong>${data.reference}</strong><br>`;
          data.verses.forEach(v => {
            html += `<sup>${v.verse}</sup> ${v.text.trim()} `;
          });
          psalmContent.innerHTML = html.trim();
        } else {
          psalmContent.textContent = "Failed to load Psalm.";
        }
      })
      .catch(() => {
        psalmContent.textContent = "Failed to load Psalm.";
      });
  });
</script>

</body>
</html>
